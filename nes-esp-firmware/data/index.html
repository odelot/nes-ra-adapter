<!doctype html>
<html lang=pt-br>
<head>
<meta charset=UTF-8>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,orientation=landscape">
<meta name=screen-orientation content=landscape>
<title>NES RA Adapter Web App</title>
<style>body,html{margin:0;padding:0;height:100%;background-color:#ece037;font-family:sans-serif}.banner{height:20vh;display:flex;align-items:center;justify-content:center;font-size:8vh;font-weight:700}.content{height:72vh;flex:1;display:flex;justify-content:center;align-items:center}.box{background-color:#000;border:2vh solid #4287f5;width:80%;height:100%;box-sizing:border-box;display:flex;flex-direction:column;justify-content:space-between;padding:2vh;border-radius:2vh}.g-title{height:30%;display:flex;justify-content:center;align-items:center;color:#fff;font-size:7vh;text-align:center}.g-img{height:70%;display:flex;justify-content:center;align-items:center}.g-img img{max-height:100%;max-width:100%;height:80%;object-fit:contain}.a-banner,.a-title{height:25%;display:flex;justify-content:center;align-items:center;color:#fff;font-size:7vh;text-align:center}.a-img{height:50%;display:flex;justify-content:center;align-items:center}.a-img img{max-height:100%;max-width:100%;height:80%;object-fit:contain}.footer-txt{height:5vh;display:flex;align-items:center;justify-content:center;font-size:2vh;font-weight:700}.status-bar{height:3vh;font-size:2vh;display:flex;align-items:center;justify-content:center}.connected{background-color:#4cff4c;color:#000}.disconnected{color:#fff;background-color:#ff4c4c}.hidden{display:none!important}#c-container{position:fixed;bottom:2vh;right:2vw;display:flex;flex-direction:row;align-items:center;gap:1vw;background-color:rgba(0,0,0,.6);padding:.5em;border-radius:.5em;z-index:1000}#c-container img{height:12vh;object-fit:contain}#p-container{position:fixed;bottom:17vh;right:2vw;display:flex;gap:1vh;background-color:rgba(0,0,0,.6);padding:.5em;border-radius:.5em;z-index:9998;max-width:90vw;overflow-x:auto}.p-item{display:flex;flex-direction:column;align-items:center;color:#fff;font-size:2vh;font-weight:700}.p-item span{margin-top:.5vh}.p-item img{height:12vh;border-radius:8px}#toast-container{position:fixed;bottom:5vh;left:50%;z-index:9999;display:flex;flex-direction:column;gap:1vh;align-items:center}.toast{background-color:rgba(0,0,0,.85);color:#fff;padding:1.5vh 3vw;font-size:2.2vh;border-radius:2vh;max-width:80vw;text-align:center;box-shadow:0 .5vh 1vh rgba(0,0,0,.3);animation:fadeInOut 4s ease-in-out forwards}@keyframes fadeInOut{0%{opacity:0;transform:translateX(-50%) translateY(2vh)}10%,90%{opacity:1;transform:translateX(-50%) translateY(0)}100%{opacity:0;transform:translateX(-50%) translateY(2vh)}}</style>
<script>let socket,is_connected=!1,achievement_timeout=null,game_name=null,game_image=null,heartbeat=null,is_alive=!0,img_prefix="https://media.retroachievements.org/Images/",user_name=null,user_token=null,game_session=null,game_id=null;function send_notification(e,t,n){try{Android&&Android.notify(e,`${game_name} - ${t}`)}catch(e){console.error("Android notify err:",e)}}function showToast(e){const t=document.getElementById("toast-container"),n=document.createElement("div");n.className="toast",n.textContent=e,t.appendChild(n),setTimeout((()=>{n.remove()}),4e3)}function log(e){console.log(e)}function show_game_info(e,t){const n=document.querySelector(".g-img img");document.getElementById("g-title").innerText=e,n.src=t,document.querySelector(".a-box").classList.add("hidden"),document.querySelector(".g-box").classList.remove("hidden")}function process_msg(e,t=!0){if(e.startsWith("G=")){const[t,n,o,s]=e.split(";");game_session=t.split("=")[1],game_name=o,game_id=n,game_image=`${img_prefix}${s}`,show_game_info(game_name,game_image);if(localStorage.getItem("game_session")==game_session){let e=localStorage.getItem("command_list");null==e&&(e=""),commands=e.split("\r\n"),commands.forEach((e=>{""!=e&&process_msg(e,!1)}))}else localStorage.clear();localStorage.setItem("game_session",game_session)}else if(e.startsWith("A=")){const[t,n,o]=e.split(";");show_achievement_info(n,o)}else if("pong"===e)is_alive=!0;else if(e.startsWith("C=")){if(t){let t=localStorage.getItem("command_list","");null==t&&(t=""),t+=e,localStorage.setItem("command_list",t)}e=e.replace("\r\n","");let[n,o,s,c]=e.split(";");const a=n.split("=")[1];"S"==a?(c=c.replace("_lock",""),add_challenge_img(o,s,c)):"H"==a&&0!=o&&remove_challenge_img(o)}else if(e.startsWith("P=")){e=e.replace("\r\n","");const[t,n,o,s,c]=e.split(";"),a=t.split("=")[1];"S"==a?add_progress_achiev(n,s,o,c):"H"==a&&hide_progress_achiev()}else e.startsWith("RESET")?localStorage.clear():log("â“: "+e)}function show_achievement_info(e,t){const n=document.querySelector(".a-img img"),o=document.getElementById("a-title");document.getElementById("a-banner");o.innerText=e,n.src=t,document.querySelector(".g-box").classList.add("hidden"),document.querySelector(".a-box").classList.remove("hidden");new Audio("snd.mp3").play(),navigator.vibrate(200),send_notification("New Achievement Unlocked",e,t),null!=achievement_timeout&&clearTimeout(achievement_timeout),achievement_timeout=setTimeout((()=>{show_game_info(game_name,game_image),achievement_timeout=null}),15e3)}function reset_screen(){remove_challenge_imgs(),hide_progress_achiev(),is_connected=!1,document.getElementById("statusBar").classList.remove("connected"),document.getElementById("statusBar").classList.add("disconnected"),document.getElementById("statusBar").innerText="Status: Disconnected",show_game_info("",`${img_prefix}046636.png`)}function connect(){log("âš ï¸conn begin"),socket=new WebSocket("ws://nes-ra-adapter.local/ws"),socket.onopen=()=>{log("âœ… connected"),is_connected=!0,document.getElementById("statusBar").classList.remove("disconnected"),document.getElementById("statusBar").classList.add("connected"),document.getElementById("statusBar").innerText="Status: Connected",is_alive=!0,heartbeat&&clearInterval(heartbeat),heartbeat=setInterval((()=>{log("ðŸ’“"),is_alive?(is_alive=!1,socket.send("ping")):(console.warn("ws died"),reset_screen(),socket.close(),clearInterval(heartbeat))}),1e4)},socket.onmessage=e=>{log("ðŸ“©:"+e.data),process_msg(e.data)},socket.onclose=()=>{log("ðŸ”Œ conn end"),reset_screen()},socket.onerror=e=>{log("âŒ: "+e)}}function add_challenge_img(e,t,n){if(document.getElementById("c-"+e))return;const o=document.getElementById("c-container"),s=document.createElement("img");s.src=n,s.alt=t,s.title=t,s.onclick=function(){console.log(this),showToast(this.title)},s.id="c-"+e,o.appendChild(s)}function remove_challenge_img(e){e=e.trim();const t=document.getElementById("c-"+e);t&&t.parentNode&&t.parentNode.removeChild(t)}function remove_challenge_imgs(){document.getElementById("c-container").querySelectorAll("img").forEach((e=>{e.remove()}))}function add_progress_achiev(e,t,n,o){const s=document.getElementById("p-container");s.querySelectorAll(".p-item").forEach((e=>{e.remove()})),s.classList.remove("hidden");const c=document.createElement("div");c.className="p-item",c.id=`p-${e}`;const a=document.createElement("img");a.src=t;const i=document.createElement("span");i.textContent=o,c.appendChild(a),c.appendChild(i),s.appendChild(c)}function hide_progress_achiev(){const e=document.getElementById("p-container");e.classList.add("hidden");e.querySelectorAll(".p-item").forEach((e=>{e.remove()}))}function keep_connected(){is_connected||(socket&&socket.readyState===WebSocket.CONNECTING?log("ðŸ”„ try conn"):connect()),setTimeout((()=>{keep_connected()}),5e3)}function enterFullscreen(){const e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}keep_connected(),document.addEventListener("click",enterFullscreen),"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then((e=>console.log("SW ok:",e.scope))).catch((e=>console.error("err service worker:",e)))</script>
</head>
<body>
<div class=banner>
NES RetroAchievements Adapter
</div>
<div class=content>
<div class="box g-box">
<div class=g-title id=g-title></div>
<div class=g-img>
<img src=https://media.retroachievements.org/Images/046636.png>
</div>
</div>
<div class="box a-box hidden">
<div class=a-banner id=a-banner>New Achievement Unlocked</div>
<div class=a-img>
<img src=https://media.retroachievements.org/Images/046636.png>
</div>
<div class=a-title id=a-title></div>
</div>
</div>
<div class=footer-txt>
By Odelot & GH
</div>
<div class="status-bar disconnected" id=statusBar>
Status: Disconnected
</div>
<div id=p-container class=hidden></div>
<div id=c-container></div>
<div id=toast-container></div>
</body>
</html>